<html>
	<head>
		<link type="text/css" href="/css/jquery-ui-1.10.4.css" rel="Stylesheet" />
		
		<script type="text/javascript" src="/js/socket.io.js"></script>
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.js"></script>
		<script type="text/javascript" src="/js/jquery-ui-1.10.4.min.js"></script>
		<script type="text/javascript" src="/js/jquery.flot.js"></script>
		<script src="http://threejs.org/build/three.min.js"></script>
		<script type="text/javascript" src="/js/mycube.js"></script>
		
		
		<script>
		$(document).ready(function(){
			// Initialize Flot data points
			var totalPoints = 1000;
			var resX = [];
			var resY = [];
			function getInitData() {
				// zip the generated y values with the x values
				for (var i = 0; i < totalPoints; ++i){
					resX.push([i, 0]);
					resY.push([i, 0]);
				}
				return [resX, resY];
			}

			// Options for Flot plot
			var options = {
				series: { shadowSize: 0 }, // drawing is faster without shadows
				yaxis: { min: 0, max: 100 },
				xaxis: { show: false }
			};
			var plot = $.plot($("#placeholder"), getInitData(), options);
			
			// Update the JQuery UI Progress Bar
			$( "#progressbar" ).progressbar({
				value: 0
			});

			var socket = io.connect('http://localhost:8000');
			socket.on('connect', function () {
				socket.on('message', function (msg) {
					// Convert value to integer
					var str_parser = /^(-?\d+\.?\d*?):(-?\d+\.?\d*?)$/;
					var parsedArray = str_parser.exec(msg)
					var valX = (parseFloat(parsedArray[1]));
					var valY = (parseFloat(parsedArray[2]));
					x = valX;
					y = valY;
					// Put sensor value to the 'sensor_value' span
					$('#sensor_value').html(valX);
					
					// Push new value to Flot Plot
					resX.push([totalPoints, valX]); // push on the end side
					resX.shift(); // remove first value to maintain 300 points
					resY.push([totalPoints, valY]); // push on the end side
					resY.shift(); // remove first value to maintain 300 points
					// reinitialize the x axis data points to 0 to 299.
					for (i=0;i<totalPoints;i++) { resX[i][0] = i; resY[i][0] = i; }
					// Redraw the plot
					plot.setData([ resX,resY ]);
					plot.draw();
					
					// Update JQuery UI progress bar.
					$( "#progressbar" ).progressbar({
						value: valX
					});
				});
			});
		});
		</script>
	</head>
	<body>
		<div role="main">
			X Value: <span id="sensor_value"></span><br/>
			<div id="progressbar" style="width:1000px;height:25px;"></div><br/>
			Graph:<br/>
			<div id="placeholder" style="width:1000px;height:300px;"></div><br/>
			<div id="container" style="height: 492px, width: 876px">
		</div>
	</body>
</html>